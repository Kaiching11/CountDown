<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å€’æ•¸è¨ˆæ™‚</title>
  <meta name="description" content="ç°¡æ½”æ¼‚äº®çš„å€’æ•¸è¨ˆæ™‚é é¢ï¼Œæ”¯æ´ç¶²å€åˆ†äº«èˆ‡æœ¬åœ°å„²å­˜ã€‚" />
  <style>
    :root {
      --bg1: #0f172a; /* slate-900 */
      --bg2: #1e293b; /* slate-800 */
      --fg: #e2e8f0;  /* slate-200 */
      --muted: #94a3b8; /* slate-400 */
      --accent: #38bdf8; /* sky-400 */
      --card: rgba(255,255,255,0.08);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 20px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      color: var(--fg);
      background: radial-gradient(1200px 600px at 20% 10%, #0b1220 0%, transparent 60%),
                  radial-gradient(900px 600px at 100% 0%, #0a2233 0%, transparent 50%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      display: grid; place-items: center; padding: 24px;
    }

    .app { width: 100%; max-width: 980px; display: grid; gap: 20px; }

    header { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    header h1 { margin: 0; font-size: clamp(22px, 4vw, 36px); letter-spacing: .5px; }

    .card { background: var(--card); border: 1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow: var(--shadow); }

    .controls { display: grid; grid-template-columns: 1fr; gap: 14px; padding: 16px; }
    @media (min-width: 720px){
      .controls { grid-template-columns: 1.2fr 1.2fr 1fr auto auto; align-items: end; }
    }

    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
    input[type="text"], input[type="datetime-local"] {
      width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25); color: var(--fg); outline: none;
    }
    input::placeholder { color: #94a3b888; }

    .btn {
      padding: 12px 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,.2);
      background: rgba(56, 189, 248, .12); color: var(--fg); cursor: pointer; white-space: nowrap;
      transition: transform .06s ease, background .2s ease;
    }
    .btn.primary { background: linear-gradient(180deg, #38bdf8, #0284c7); border: none; box-shadow: 0 8px 20px rgba(56,189,248,.35); }
    .btn:hover { transform: translateY(-1px); }

    .timer { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; padding: 24px; }
    @media (max-width: 520px){ .timer { grid-template-columns: repeat(2, 1fr); } }

    .unit { text-align: center; padding: 18px 14px; border-radius: 18px; background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.06); }
    .value { font-variant-numeric: tabular-nums; font-weight: 800; font-size: clamp(28px, 8vw, 64px); line-height: 1; }
    .label { color: var(--muted); margin-top: 8px; font-size: 12px; letter-spacing: .4px; text-transform: uppercase; }

    .subtitle { color: var(--muted); font-size: 14px; margin: -6px 0 2px; }

    footer { text-align: center; color: var(--muted); font-size: 12px; padding: 10px; }
    a, button.link { color: #7dd3fc; text-decoration: none; }
    .row { display: grid; gap: 8px; }

    .bad { color: #fca5a5; }
    .good { color: #86efac; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1 id="pageTitle">å€’æ•¸è¨ˆæ™‚</h1>
      <button id="shareBtn" class="btn" title="æŠŠç›®å‰è¨­å®šåˆ†äº«ç‚ºç¶²å€">åˆ†äº«ç¶²å€</button>
    </header>

    <p id="subtitle" class="subtitle"></p>

    <section class="card controls">
      <div class="row">
        <label for="title">æ¨™é¡Œ</label>
        <input id="title" type="text" placeholder="ä¾‹å¦‚ï¼šè·é›¢ä¹å¯¨æºä¹‹æ—… ğŸ”ï¸ å‡ºç™¼" />
      </div>
      <div class="row">
        <label for="target">ç›®æ¨™æ™‚é–“ï¼ˆä¾ä½ æœ¬æ©Ÿæ™‚å€ï¼‰</label>
        <input id="target" type="datetime-local" />
      </div>
      <div class="row">
        <label>&nbsp;</label>
        <button id="nowPlus" class="btn" title="å¿«é€Ÿè¨­å®š 30 å¤©å¾Œ">+ 30 å¤©</button>
      </div>
      <button id="startBtn" class="btn primary">é–‹å§‹ / æ›´æ–°</button>
      <button id="resetBtn" class="btn">é‡è¨­</button>
    </section>

    <section class="card timer" aria-live="polite" aria-atomic="true">
      <div class="unit"><div class="value" id="days">00</div><div class="label">å¤©</div></div>
      <div class="unit"><div class="value" id="hours">00</div><div class="label">æ™‚</div></div>
      <div class="unit"><div class="value" id="minutes">00</div><div class="label">åˆ†</div></div>
      <div class="unit"><div class="value" id="seconds">00</div><div class="label">ç§’</div></div>
    </section>

    <footer>
      <span id="status"></span>
      <div style="margin-top:6px">
        <button class="link" id="clearLS" title="æ¸…é™¤æœ¬æ©Ÿå„²å­˜">æ¸…é™¤æœ¬æ©Ÿå„²å­˜</button>
        Â· <a href="#" id="exampleLink">è¼‰å…¥ç¯„ä¾‹</a>
      </div>
    </footer>
  </div>

  <script>
    // ===== å°å·¥å…· =====
    const qs = (s, el=document) => el.querySelector(s);
    const fmt2 = n => String(Math.floor(Math.abs(n))).padStart(2, '0');
    const toLocalInputValue = (date) => {
      // ç”¢ç”Ÿé©ç”¨æ–¼ input[type=datetime-local] çš„å€¼
      const pad = (n) => String(n).padStart(2,'0');
      return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
    };

    function parseFromParam(v){
      // æ”¯æ´ ISO 8601ï¼ˆå«æ™‚å€ï¼‰æˆ–ä¸å«ç§’çš„ datetime-local æ¨£å¼
      if(!v) return null;
      const d = new Date(v);
      return isNaN(d.getTime()) ? null : d;
    }

    function setTitle(t){
      const title = t && t.trim() ? t.trim() : 'å€’æ•¸è¨ˆæ™‚';
      document.title = title;
      qs('#pageTitle').textContent = title;
    }

    // ===== ç‹€æ…‹ =====
    const st = {
      title: localStorage.getItem('ct_title') || '',
      targetISO: localStorage.getItem('ct_target') || '',
      timer: null
    };

    // ===== å…ƒä»¶ =====
    const elTitle = qs('#title');
    const elTarget = qs('#target');
    const elStart = qs('#startBtn');
    const elReset = qs('#resetBtn');
    const elPlus = qs('#nowPlus');
    const elStatus = qs('#status');
    const btnShare = qs('#shareBtn');

    const dEl = {
      days: qs('#days'), hours: qs('#hours'), minutes: qs('#minutes'), seconds: qs('#seconds')
    };

    // ===== åˆå§‹åŒ–ï¼šè®€å–ç¶²å€åƒæ•¸æˆ– LocalStorage =====
    (function init(){
      const url = new URL(location.href);
      const p = url.searchParams;
      const pTitle = p.get('title');
      const pTarget = p.get('target');

      // å…è¨±ä»¥ç¶²å€åƒæ•¸è¦†è“‹æœ¬åœ°è³‡æ–™
      if(pTitle) st.title = pTitle;
      if(pTarget) st.targetISO = pTarget;

      setTitle(st.title);
      elTitle.value = st.title;

      if(st.targetISO){
        const d = parseFromParam(st.targetISO);
        if(d){ elTarget.value = toLocalInputValue(d); }
      }

      updateSubtitle();
      startTicker();

      // ç¯„ä¾‹é€£çµ
      qs('#exampleLink').addEventListener('click', (e)=>{
        e.preventDefault();
        const t = new Date();
        t.setDate(t.getDate()+100);
        elTitle.value = 'è·é›¢åŠé¦¬ PB ğŸ’ª';
        elTarget.value = toLocalInputValue(t);
        elStart.click();
      });
    })();

    function updateSubtitle(){
      const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'æœ¬æ©Ÿæ™‚å€';
      qs('#subtitle').textContent = `ä½ çš„æ™‚å€ï¼š${tz}`;
    }

    function startTicker(){
      clearInterval(st.timer);
      tick();
      st.timer = setInterval(tick, 1000);
    }

    function tick(){
      const now = new Date();
      const targetVal = elTarget.value || st.targetISO;
      const t = parseFromParam(targetVal);

      if(!t){
        setDigits(0,0,0,0);
        elStatus.innerHTML = '<span class="bad">å°šæœªè¨­å®šç›®æ¨™æ™‚é–“</span>';
        return;
      }

      const diff = t.getTime() - now.getTime();
      if (isNaN(diff)) {
        elStatus.innerHTML = '<span class="bad">æ™‚é–“æ ¼å¼ä¸æ­£ç¢º</span>';
        return;
      }

      if(diff <= 0){
        setDigits(0,0,0,0);
        elStatus.innerHTML = '<span class="good">ğŸ‰ å·²åˆ°é”ç›®æ¨™æ™‚é–“ï¼</span>';
        return;
      }

      const sec = Math.floor(diff/1000);
      const days = Math.floor(sec / 86400);
      const hours = Math.floor((sec % 86400) / 3600);
      const minutes = Math.floor((sec % 3600) / 60);
      const seconds = sec % 60;
      setDigits(days, hours, minutes, seconds);

      const display = `${days} å¤© ${fmt2(hours)}:${fmt2(minutes)}:${fmt2(seconds)}`;
      elStatus.textContent = `å‰©é¤˜ï¼š${display}`;
    }

    function setDigits(d,h,m,s){
      dEl.days.textContent = String(d).padStart(2,'0');
      dEl.hours.textContent = fmt2(h);
      dEl.minutes.textContent = fmt2(m);
      dEl.seconds.textContent = fmt2(s);
    }

    // ===== äº‹ä»¶ =====
    elStart.addEventListener('click', () => {
      st.title = elTitle.value.trim();
      setTitle(st.title);

      // å°‡ input çš„æœ¬åœ°æ™‚é–“è½‰æˆ ISOï¼ˆä¿ç•™æœ¬åœ°åç§»ï¼‰
      const v = elTarget.value;
      if(v){
        const d = new Date(v);
        st.targetISO = d.toISOString(); // ä»¥ ISO å„²å­˜ï¼Œæ–¹ä¾¿è·¨è£ç½®
      }

      localStorage.setItem('ct_title', st.title);
      localStorage.setItem('ct_target', st.targetISO);
      startTicker();
    });

    elReset.addEventListener('click', () => {
      elTitle.value = '';
      elTarget.value = '';
      st.title = '';
      st.targetISO = '';
      localStorage.removeItem('ct_title');
      localStorage.removeItem('ct_target');
      setTitle('å€’æ•¸è¨ˆæ™‚');
      tick();
    });

    elPlus.addEventListener('click', () => {
      const base = elTarget.value ? new Date(elTarget.value) : new Date();
      base.setDate(base.getDate() + 30);
      elTarget.value = toLocalInputValue(base);
    });

    btnShare.addEventListener('click', async () => {
      const url = new URL(location.href);
      const p = url.searchParams;
      if(st.title) p.set('title', st.title);
      if(st.targetISO) p.set('target', st.targetISO);
      else if(elTarget.value){ p.set('target', new Date(elTarget.value).toISOString()); }
      url.search = p.toString();
      const shareURL = url.toString();

      if(navigator.clipboard){
        try {
          await navigator.clipboard.writeText(shareURL);
          notify('å·²è¤‡è£½åˆ†äº«é€£çµåˆ°å‰ªè²¼ç°¿');
        } catch(e){
          alert('è«‹æ‰‹å‹•è¤‡è£½ç¶²å€ï¼š\n' + shareURL);
        }
      } else {
        alert('è«‹æ‰‹å‹•è¤‡è£½ç¶²å€ï¼š\n' + shareURL);
      }
    });

    qs('#clearLS').addEventListener('click', () => {
      localStorage.removeItem('ct_title');
      localStorage.removeItem('ct_target');
      notify('å·²æ¸…é™¤æœ¬æ©Ÿå„²å­˜');
    });

    function notify(msg){
      const bar = document.createElement('div');
      bar.textContent = msg;
      bar.style.position = 'fixed';
      bar.style.left = '50%';
      bar.style.bottom = '24px';
      bar.style.transform = 'translateX(-50%)';
      bar.style.background = 'rgba(15,23,42,.9)';
      bar.style.border = '1px solid rgba(255,255,255,.15)';
      bar.style.color = 'white';
      bar.style.padding = '10px 14px';
      bar.style.borderRadius = '12px';
      bar.style.boxShadow = '0 10px 30px rgba(0,0,0,.35)';
      document.body.appendChild(bar);
      setTimeout(()=>bar.remove(), 1500);
    }
  </script>
</body>
</html>
